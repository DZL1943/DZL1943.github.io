"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[9757],{28453(n,e,t){t.d(e,{R:()=>s,x:()=>i});var r=t(96540);const o={},a=r.createContext(o);function s(n){const e=r.useContext(a);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),r.createElement(a.Provider,{value:e},n.children)}},76840(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Computer/Programming/Rust/tokio","title":"tokio","description":"\u5165\u95e8","source":"@site/vault/docs/Computer/60_Programming/Rust/tokio.md","sourceDirName":"Computer/60_Programming/Rust","slug":"/Computer/Programming/Rust/tokio","permalink":"/docs/Computer/Programming/Rust/tokio","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768098026000,"frontMatter":{},"sidebar":"computerSidebar","previous":{"title":"tauri","permalink":"/docs/Computer/Programming/Rust/tauri"},"next":{"title":"Scala","permalink":"/docs/Computer/Programming/Scala"}}');var o=t(74848),a=t(28453);const s={},i=void 0,c={},l=[{value:"\u5165\u95e8",id:"\u5165\u95e8",level:2}];function u(n){const e={code:"code",h2:"h2",pre:"pre",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h2,{id:"\u5165\u95e8",children:"\u5165\u95e8"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-toml",children:'[dependencies]\ntokio = { version = "1.38.1", features = ["full"] }\n'})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-rust",children:'//! A simple client that opens a TCP stream, writes "hello world\\n", and closes\n//! the connection.\n//!\n//! To start a server that this client can talk to on port 6142, you can use this command:\n//!\n//!     ncat -l 6142\n//!\n//! And then in another terminal run:\n//!\n//!     cargo run --example hello_world\n\n#![warn(rust_2018_idioms)]\n\nuse tokio::io::AsyncWriteExt;\nuse tokio::net::TcpStream;\n\nuse std::error::Error;\n\n#[tokio::main]\npub async fn main() -> Result<(), Box<dyn Error>> {\n    // Open a TCP stream to the socket address.\n    //\n    // Note that this is the Tokio TcpStream, which is fully async.\n    let mut stream = TcpStream::connect("127.0.0.1:6142").await?;\n    println!("created stream");\n\n    let result = stream.write_all(b"hello world\\n").await;\n    println!("wrote to stream; success={:?}", result.is_ok());\n\n    Ok(())\n}\n'})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-rust",children:'use tokio::net::TcpListener;\nuse tokio::io::{AsyncReadExt, AsyncWriteExt};\n\n#[tokio::main]\nasync fn main() -> Result<(), Box<dyn std::error::Error>> {\n    let listener = TcpListener::bind("127.0.0.1:8080").await?;\n\n    loop {\n        let (mut socket, _) = listener.accept().await?;\n\n        tokio::spawn(async move {\n            let mut buf = [0; 1024];\n\n            // In a loop, read data from the socket and write the data back.\n            loop {\n                let n = match socket.read(&mut buf).await {\n                    // socket closed\n                    Ok(n) if n == 0 => return,\n                    Ok(n) => n,\n                    Err(e) => {\n                        eprintln!("failed to read from socket; err = {:?}", e);\n                        return;\n                    }\n                };\n\n                // Write the data back\n                if let Err(e) = socket.write_all(&buf[0..n]).await {\n                    eprintln!("failed to write to socket; err = {:?}", e);\n                    return;\n                }\n            }\n        });\n    }\n}\n'})})]})}function m(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(u,{...n})}):u(n)}}}]);