"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[88614],{28453(n,e,s){s.d(e,{R:()=>o,x:()=>r});var t=s(96540);const i={},a=t.createContext(i);function o(n){const e=t.useContext(a);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),t.createElement(a.Provider,{value:e},n.children)}},95913(n,e,s){s.r(e),s.d(e,{assets:()=>p,contentTitle:()=>r,default:()=>f,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Computer/OS/Linux/dotfiles \u7ba1\u7406","title":"dotfiles \u7ba1\u7406","description":"\u7ba1\u7406\u5de5\u5177","source":"@site/vault/docs/Computer/20_OS/Linux/dotfiles \u7ba1\u7406.md","sourceDirName":"Computer/20_OS/Linux","slug":"/Computer/OS/Linux/dotfiles \u7ba1\u7406","permalink":"/docs/Computer/OS/Linux/dotfiles \u7ba1\u7406","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768141604000,"frontMatter":{"modified":"2026-01-11T22:24","date":"2025-10-30T09:14"},"sidebar":"computerSidebar","previous":{"title":"date","permalink":"/docs/Computer/OS/Linux/date"},"next":{"title":"openssl","permalink":"/docs/Computer/OS/Linux/openssl"}}');var i=s(74848),a=s(28453);const o={modified:"2026-01-11T22:24",date:"2025-10-30T09:14"},r=void 0,p={},c=[{value:"\u7ba1\u7406\u5de5\u5177",id:"\u7ba1\u7406\u5de5\u5177",level:2},{value:"python \u5b9e\u73b0",id:"python-\u5b9e\u73b0",level:2},{value:"\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",id:"\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",level:2}];function l(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"\u7ba1\u7406\u5de5\u5177",children:"\u7ba1\u7406\u5de5\u5177"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.gnu.org/software/stow/",children:"stow"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/lra/mackup",children:"mackup"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://chezmoi.io/",children:"chezmoi"})}),"\n",(0,i.jsx)(e.li,{children:"dotbot"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"python-\u5b9e\u73b0",children:"python \u5b9e\u73b0"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"[!note]-"}),"\n",(0,i.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",checked:!0,disabled:!0})," ","\u652f\u6301\u7b80\u6613\u914d\u7f6e"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u652f\u6301\u5220\u9664\u5907\u4efd"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u652f\u6301 ignore"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","\u652f\u6301\u7b80\u6613\u6a21\u5f0f (\u6240\u6709 app \u6309\u539f\u8def\u5f84\u7ec4\u7ec7, \u800c\u4e0d\u662f\u5404\u81ea\u72ec\u7acb)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"import argparse\nimport os\nfrom pathlib import Path\nimport shutil\nimport yaml\n\n\nclass BackupManager:\n    def __init__(self, config='config.yaml', source_root=None, backup_root=None):\n        self.config = self._load_config(config) if os.path.isfile(config) else config\n        self.source_root = Path(source_root).expanduser().resolve() if source_root else Path.home()\n        self.backup_root = Path(backup_root).expanduser().resolve() if backup_root else Path.cwd()\n\n    @staticmethod\n    def _load_config(config_file):\n        with open(config_file) as f:\n            return yaml.safe_load(f)\n\n    @staticmethod\n    def _resolve_path(path, root=None):\n        path_obj = Path(path)\n        return (root / path_obj).resolve() if root else path_obj.expanduser().resolve()\n\n    @staticmethod\n    def _copy(src, dst):\n        dst.parent.mkdir(parents=True, exist_ok=True)\n        \n        if src.is_file():\n            shutil.copy2(src, dst)\n        elif src.is_dir():\n            if dst.exists():\n                shutil.rmtree(dst)\n            shutil.copytree(src, dst)\n        else:\n            raise FileNotFoundError(f\"\u8def\u5f84\u4e0d\u5b58\u5728: {src}\")\n\n    def _get_app_paths(self, app):\n        app_config = self.config.get(app, {})\n\n        if isinstance(app_config, list):\n            paths = app_config\n            prefix = app\n        else:\n            paths = app_config.get('paths', [])\n            prefix = app_config.get('prefix', app)\n        \n        result = []\n        for item in paths:\n            if isinstance(item, str):\n                src, dst = item, Path(item).name\n            elif isinstance(item, dict):\n                src, dst = next(iter(item.items()))\n            else:\n                continue\n                \n            result.append((src, str(Path(prefix) / dst)))\n            \n        return result\n\n    def _is_backed_up(self, app):\n        return any(self._resolve_path(dst, self.backup_root).exists() for _, dst in self._get_app_paths(app))\n\n    def list_apps(self, apps=None, backup_status=None):\n        if not apps:\n            apps = self.config\n        for app in apps:\n            if app not in self.config:\n                continue\n            if backup_status is not None and self._is_backed_up(app) != backup_status:\n                continue\n            print(app)\n            if apps:\n                for src, dst in self._get_app_paths(app):\n                    print(f\"- {src} -> {dst}\")\n\n    def backup(self, apps):\n        if not apps:\n            apps = self.config\n        for app in apps:\n            if app not in self.config:\n                continue\n            print(f\"\u5907\u4efd {app}\")\n            for src, dst in self._get_app_paths(app):\n                try:\n                    self._copy(self._resolve_path(src, self.source_root), self._resolve_path(dst, self.backup_root))\n                    print(f\"\u2713 {src}\")\n                except Exception as e:\n                    print(f\"\u2717 {src} - {e}\")\n\n    def restore(self, apps):\n        if not apps:\n            apps = self.config\n        for app in apps:\n            if app not in self.config:\n                continue\n            print(f\"\u6062\u590d {app}\")\n            for src, dst in self._get_app_paths(app):\n                try:\n                    self._copy(self._resolve_path(dst, self.backup_root), self._resolve_path(src, self.source_root))\n                    print(f\"\u2713 {src}\")\n                except Exception as e:\n                    print(f\"\u2717 {src} - {e}\")\n\n\ndef main():\n    parser = argparse.ArgumentParser(description='\u914d\u7f6e\u5907\u4efd\u6062\u590d\u5de5\u5177')\n    parser.add_argument('action', choices=['backup', 'restore', 'list'])\n    parser.add_argument('--app', nargs='+', help='\u5e94\u7528\u540d\u79f0')\n    parser.add_argument('--config', default='config.yaml')\n    parser.add_argument('--source-root', help='\u6e90\u6839\u8def\u5f84,\u9ed8\u8ba4\u4e3a\u5bb6\u76ee\u5f55')\n    parser.add_argument('--backup-root', help='\u5907\u4efd\u6839\u8def\u5f84,\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55')\n    group = parser.add_mutually_exclusive_group()\n    group.add_argument('--backed-up', action='store_true', dest='backup_status', help='\u4ec5\u5217\u51fa\u5df2\u5907\u4efd\u7684\u5e94\u7528')\n    group.add_argument('--not-backed-up', action='store_false', dest='backup_status', help='\u4ec5\u5217\u51fa\u672a\u5907\u4efd\u7684\u5e94\u7528')\n    parser.set_defaults(backup_status=None)\n    \n    args = parser.parse_args()\n    mgr = BackupManager(args.config, args.source_root, args.backup_root)\n\n    match args.action:\n        case 'list': \n            mgr.list_apps(args.app, args.backup_status)\n        case 'backup': \n            mgr.backup(args.app)\n        case 'restore': \n            mgr.restore(args.app)\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",children:"\u914d\u7f6e\u6587\u4ef6\u8def\u5f84"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"Shell:\n    - .alias\n    - .env\n    - .profile\n    - .bash_profile\n    - .bashrc\n    - .zshenv\n    - .zprofile\n    - .zshrc\n    - .config/fish/config.fish\nTmux:\n    - .tmux.conf\nKitty:\n    - .config/kitty/kitty.conf\nGhostty:\n    - .config/ghostty/config\nAlacritty:\n    - .config/alacritty/alacritty.yml\niTerm2:\n    - Library/Preferences/com.googlecode.iterm2.plist\n    - .config/iterm2/AppSupport/DynamicProfiles/\nHelix:\n    - .config/helix/config.toml\n    - .config/helix/languages.toml\nVim:\n    - .vimrc\n    - .gvimrc\n    - .vim/\nNeovim:\n    - .config/nvim/\nEmacs:\n    - .emacs\n    - .emacs.d/\n    - .config/emacs/\n    - .config/doom/\n    - .doom.d/\n    - .spacemacs.d/\n    - .spacemacs\nVSCode:\n    - Library/Application Support/Code/User/settings.json\n    - Library/Application Support/Code/User/keybindings.json\nZed:\n    - .config/zed/settings.json\nYazi:\n    - .config/yazi/yazi.toml\nMackup:\n    - .mackup.cfg\n    - .mackup/\nGit:\n    - .gitconfig\nSSH:\n    - .ssh/config\npip:\n    - .config/pip/pip.conf\nConda:\n    - .condarc\nnpm:\n    - .npmrc\n#maven:\nCargo:\n    - .cargo/config.toml\nOrbstack:\n    - .orbstack/config/docker.json\nRime:\n    - Library/Rime/\nfcitx5:\n    - .config/fcitx5/: .config/\n    - .local/share/fcitx5/: .local/share/\nHammerspoon:\n    - .hammerspoon/init.lua\n#Raycast:\n#Karabiner:\nmac-mouse-fix:\n    - Library/Application Support/com.nuebling.mac-mouse-fix/config.plist\nxGestures:\n    - Library/Preferences/what.xGestures.plist\nStats:\n    - Library/Preferences/eu.exelban.Stats.plist\nDockDoor:\n    - Library/Preferences/com.ethanbills.DockDoor.plist\n#Firefox:\n"})})]})}function f(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}}}]);