"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[3915],{26497(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"Computer/Application/Hammerspoon","title":"Hammerspoon","description":"\u914d\u7f6e","source":"@site/vault/docs/Computer/90_Application/Hammerspoon.md","sourceDirName":"Computer/90_Application","slug":"/Computer/Application/Hammerspoon","permalink":"/docs/Computer/Application/Hammerspoon","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768143256000,"frontMatter":{"modified":"2025-10-21T09:56","url":["http://www.hammerspoon.org/"],"date":"2025-10-21T09:13"},"sidebar":"appSidebar","previous":{"title":"GitHub","permalink":"/docs/Computer/Application/GitHub"},"next":{"title":"Helix","permalink":"/docs/Computer/Application/Helix"}}');var a=t(74848),s=t(28453);const i={modified:"2025-10-21T09:56",url:["http://www.hammerspoon.org/"],date:"2025-10-21T09:13"},l=void 0,c={},r=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2}];function p(n){const e={code:"code",h2:"h2",pre:"pre",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-lua",children:"-- hammerspoon config example\n-- date: 2023-05-24\n\nlocal obj = {}\nobj._metadata = {\n    name = 'hammerspoon config example',\n    version = '1.0',\n    author = '',\n    homepage = '',\n    license = 'MIT - https://opensource.org/licenses/MIT',\n}\n\nobj.cfg = {}\nobj.map = {\n    reloadConfig = { { 'ctrl', 'alt' }, 'r' },\n    toggleHelp = { { 'ctrl', 'alt' }, '/' },\n    windowManager = { { 'ctrl', 'alt' }, 'w' },\n    toggleClock = {{'ctrl', 'alt'}, 't'},\n    --restartBt = {{'ctrl', 'alt'}, 'b'},\n}\nobj.spoons = {}\n\n----\nfunction obj:init()\n    for k, v in pairs(obj._metadata) do obj[k] = v end\n    for _, v in ipairs(obj.spoons) do hs.loadSpoon(v) end\n\n    obj.watchers = {}\n    obj.timers = {}\n    obj.canvases = {}\n    return self\nend\n\nfunction obj:start()\n    obj:_setupReloadConfig()\n    -- obj:_setupAppLauncher()\n    obj:_setupWindowManager()\n    obj:_toggleClock(true)\n    obj:_setupCaffeinateWatcher()\n    -- obj:_mousetap()\n    return self\nend\n\nfunction obj:stop()\n    return self\nend\n\nfunction obj:bindHotkeys(mapping)\n    local def = {\n        toggleHelp = function()\n            obj:_toggleHelp()\n        end,\n        toggleClock = function ()\n            obj:_toggleClock()\n        end,\n        restartBt = function ()\n            obj:_switchBluetooth(0)\n            obj:_switchBluetooth(1)\n        end,\n    }\n    for k, v in pairs(mapping) do\n        if def[k] then\n            hs.hotkey.bind(v[1], v[2], def[k])\n        end\n    end\n    return self\nend\n\n---\nfunction obj:_setupReloadConfig()\n    local function notifyAndReload()\n        hs.notify.new({ title = \"Hammerspoon\", informativeText = \"Config reloaded.\" }):send()\n        hs.reload()\n    end\n\n    local cfgWatcher = obj.watchers['cfgWatcher']\n    if not cfgWatcher or not cfgWatcher:running() then\n        cfgWatcher = hs.pathwatcher.new(hs.configdir, notifyAndReload)\n        obj.watchers['cfgWatcher'] = cfgWatcher\n        cfgWatcher:start()\n    end\n\n    local keys = obj.map['reloadConfig']\n    hs.hotkey.bind(keys[1], keys[2], notifyAndReload)\nend\n\nfunction obj:_setupAppLauncher(keymap, modifiers)\n    local modifiers = modifiers or 'alt+cmd'\n    local keymap = keymap or {\n        a = 'App Store',\n        b = 'Safari',\n        c = 'Visual Studio Code',\n        --d = 'TickTick',\n        d = 'Eudic',\n        e = 'Emacs',\n        f = 'Finder',\n        --g = 'Google Chrome',\n        g = 'Microsoft Edge',\n        h = 'Hammerspoon',\n        --i = 'iTerm',\n        --j = 'Activity Monitor',\n        --k = 'Shortcuts',\n        --l = 'Launchpad',\n        m = 'com.tencent.QQMusicMac',\n        n = 'Notion',\n        --o = 'Microsoft Outlook',\n        o = 'Obsidian',\n        p = 'Photos',\n        q = 'QQ',\n        r = 'Reminders',\n        s = 'System Preferences',\n        t = 'iTerm',\n        --u = 'Eudic',\n        v = 'MacVim',\n        w = 'WeChat',\n        x = 'XMind',\n        y = 'Mail',\n        --z = 'System Preferences'\n    }\n\n    for k, v in pairs(keymap) do\n        hs.hotkey.bind(modifiers, k, function()\n            if not hs.application.launchOrFocus(v) then\n                hs.application.launchOrFocusByBundleID(v)\n            end\n        end)\n        -- update obj.map\n        obj.map[v] = { modifiers, k }\n    end\nend\n\nfunction obj:_setupWindowManager()\n    local id = 'windowManager'\n    local keys = obj.map[id]\n    local cmodal = hs.hotkey.modal.new(keys[1], keys[2])\n\n    function cmodal:entered() hs.alert(string.format('Entered %s mode', id)) end\n\n    function cmodal:exited() hs.alert(string.format('Exited %s mode', id)) end\n\n    cmodal:bind('', 'escape', function()\n        cmodal:exit()\n    end)\n\n    local function move(direction, step)\n        local step = step or 10\n        local w = hs.window.focusedWindow()\n        local f = w:frame()\n\n        if direction == 'up' then\n            f.y = f.y - step\n        end\n        if direction == 'down' then\n            f.y = f.y + step\n        end\n        if direction == 'left' then\n            f.x = f.x - step\n        end\n        if direction == 'right' then\n            f.x = f.x + step\n        end\n        w:setFrame(f)\n    end\n\n    local mapping = {\n        up = 'k',\n        down = 'j',\n        left = 'h',\n        right = 'l',\n    }\n    cmodal:bind('ctrl+alt', '/', function()\n        obj:_toggleHelp(mapping)\n    end)\n\n    for k, v in pairs(mapping) do\n        cmodal:bind('', v, function()\n            move(k)\n        end)\n    end\nend\n\nfunction obj:_toggleHelp(data)\n    local function create()\n        local mainRes = hs.screen.primaryScreen():fullFrame()\n        local helpCanvas = hs.canvas.new({ x = (mainRes.w - 600) / 2, y = (mainRes.h - 700) / 2, w = 600, h = 700 }):\n            appendElements(\n                {\n                    type = \"rectangle\",\n                    action = \"fill\",\n                    fillColor = { hex = \"#EEEEEE\", alpha = 0.95 },\n                    roundedRectRadii = { xRadius = 10, yRadius = 10 },\n                },\n                {\n                    type = 'text',\n                    text = hs.inspect(data or obj.map) .. '\\n\\n \ud83d\ude04',\n                    textSize = 20,\n                    textColor = { hex = \"#2390FF\", alpha = 1 },\n                    textAlignment = 'left',\n                }\n            )\n        return helpCanvas\n    end\n\n    local helpCanvas = obj.canvases['helpCanvas']\n\n    if not helpCanvas then\n        helpCanvas = create()\n        obj.canvases['helpCanvas'] = helpCanvas\n    end\n    if helpCanvas:isShowing() then\n        helpCanvas:hide()\n    else\n        helpCanvas:show()\n    end\nend\n\nfunction obj:_toggleClock(bool)\n    local function create()\n        local mainRes = hs.screen.primaryScreen():fullFrame()\n        local clockCanvas = hs.canvas.new({x=0, y=mainRes.h - 60*2, w=200, h=60*2}):appendElements(\n            {\n                type = 'rectangle',\n                action = 'fill',\n                fillColor = {red=0, blue=0, green=0, alpha=0}\n            },\n            {\n                type = 'text',\n                text = os.date('%a %b %e'),\n                textSize = 20,\n                textColor = {hex='#1891C3'},\n                textAlignment = 'left',\n                frame = {x=10, y=30, w=200, h=60}\n            },\n            {\n                type = 'text',\n                text = os.date('%H:%M'),\n                textSize = 40,\n                textColor = {hex='#1891C3'},\n                textAlignment = 'left',\n                frame = {x=10, y=60, w=120, h=60}\n            }\n        )\n        clockCanvas:bringToFront(true)\n        clockCanvas:behavior(hs.canvas.windowBehaviors.canJoinAllSpaces)\n        return clockCanvas\n    end\n\n    local clockCanvas = obj.canvases['clockCanvas']\n    local clockTimer = obj.timers['clockTimer']\n\n    if not clockCanvas then\n        clockCanvas = create()\n        obj.canvases['clockCanvas'] = clockCanvas\n        clockTimer = hs.timer.doEvery(20, function()\n            clockCanvas[2].text = os.date('%a %b %e')\n            clockCanvas[3].text = os.date('%H:%M')\n        end)\n        obj.timers['clockTimer'] = clockTimer\n    end\n    if clockCanvas:isShowing() then\n        if not bool then\n            clockCanvas:hide()\n        end\n    else\n        if bool ~= false then\n            clockCanvas:show()\n        end\n    end\nend\n\nfunction obj:_mousetap()\n    -- positive multiplier (== natural scrolling) makes mouse work like traditional scrollwheel\n    local scrollmult = 4\n\n    -- The were all events logged, when using `{\"all\"}`\n    mousetap = hs.eventtap.new({\"all\"}, function(e)\n        local oldmousepos = hs.mouse.absolutePosition()\n        -- local mods = hs.eventtap.checkKeyboardModifiers()\n        local pressedMouseButton = e:getProperty(hs.eventtap.event.properties['mouseEventButtonNumber'])\n        -- print(pressedMouseButton)\n\n        local typ = e:getType(true)\n        if typ == 27 then\n            -- \u6309\u4f4f\u4e2d\u952e\u5de6\u53f3\u62d6\u62fd\u5b9e\u73b0\u6c34\u5e73\u6eda\u52a8 (\u82e5\u65e0\u6548\u8bf7\u5148\u5173\u95ed\u5176\u4ed6\u624b\u52bf\u76d1\u63a7\u8f6f\u4ef6)\n            -- print(typ)\n            local dx = e:getProperty(hs.eventtap.event.properties['eventUnacceleratedPointerMovementX'])\n            local dy = e:getProperty(hs.eventtap.event.properties['eventUnacceleratedPointerMovementY'])\n            -- print(dx)\n            -- print(dy)\n            local scroll = hs.eventtap.event.newScrollEvent({dx * scrollmult, dy * scrollmult},{},'pixel')\n            scroll:post()\n            \n            -- put the mouse back\n            -- hs.mouse.absolutePosition(oldmousepos)\n            \n            return true, {scroll}\n        else\n            return false, {}\n        end\n    end)\n    mousetap:start()\nend\n\nfunction obj:_switchBluetooth(state)\n    -- STATE can be one of: 1, on, 0, off\n    local cmd = \"/opt/homebrew/bin/blueutil --power \"..(state)\n    hs.osascript.applescript(string.format('do shell script \"%s\"', cmd))\nend\n\nfunction obj:_setupCaffeinateWatcher()\n    local function quitApps()\n        local apps = {'Clash Verge', 'OBS'}\n        for _, app in ipairs(apps) do\n            hs.osascript.applescript(string.format('quit app \"%s\"', app))\n        end\n    end\n\n    local function caffeCallback(e)\n        if (e == hs.caffeinate.watcher.screensDidSleep) then\n            print(\"screensDidSleep\")\n            local output, status, type, rc = hs.execute(string.format('/usr/bin/osascript \"%s\" 2>&1', os.getenv('HOME')..'/bin/quitapps.applescript'), true)\n            print(output)\n        elseif (e == hs.caffeinate.watcher.screensDidWake) then\n            print(\"screensDidWake\")\n        elseif (e == hs.caffeinate.watcher.screensDidLock) then\n            print(\"screensDidLock\")\n            quitApps()\n        elseif (e == hs.caffeinate.watcher.screensDidUnlock) then\n            print(\"screensDidUnlock\")\n            -- obj:_switchBluetooth(0)\n            -- obj:_switchBluetooth(1)\n        end\n    end\n\n    local caffeWatcher = hs.caffeinate.watcher.new(caffeCallback)\n    obj.watchers['caffeWatcher'] = caffeWatcher\n    caffeWatcher:start()\nend\n\n---- main\nobj:init():bindHotkeys(obj.map):start()\nreturn obj\n"})})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},28453(n,e,t){t.d(e,{R:()=>i,x:()=>l});var o=t(96540);const a={},s=o.createContext(a);function i(n){const e=o.useContext(s);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:i(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);