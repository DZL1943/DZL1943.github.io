"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[6318],{28453(n,t,e){e.d(t,{R:()=>o,x:()=>r});var a=e(96540);const s={},i=a.createContext(s);function o(n){const t=a.useContext(i);return a.useMemo(function(){return"function"==typeof n?n(t):{...t,...n}},[t,n])}function r(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),a.createElement(i.Provider,{value:t},n.children)}},90113(n,t,e){e.r(t),e.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Computer/Application/Obsidian/Obsidian Community Plugins","title":"Obsidian \u793e\u533a\u63d2\u4ef6","description":"","source":"@site/vault/docs/Computer/90_Application/Obsidian/Obsidian Community Plugins.md","sourceDirName":"Computer/90_Application/Obsidian","slug":"/Computer/Application/Obsidian/Obsidian Community Plugins","permalink":"/docs/Computer/Application/Obsidian/Obsidian Community Plugins","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768144823000,"frontMatter":{"title":"Obsidian \u793e\u533a\u63d2\u4ef6","modified":"2025-10-08T21:19","obsidianEditingMode":"source","date":"2025-10-08T21:18"},"sidebar":"obsidianSidebar","previous":{"title":"Obsidian \u547d\u4ee4","permalink":"/docs/Computer/Application/Obsidian/Obsidian Commands"},"next":{"title":"Obsidian Plugins","permalink":"/docs/Computer/Application/Obsidian/Obsidian Plugins"}}');var s=e(74848),i=e(28453);const o={title:"Obsidian \u793e\u533a\u63d2\u4ef6",modified:"2025-10-08T21:19",obsidianEditingMode:"source",date:"2025-10-08T21:18"},r=void 0,d={},l=[];function p(n){const t={code:"code",pre:"pre",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",metastring:"fold title:jq",children:"jq -n --slurpfile stats Misc/community-plugin-stats.json --slurpfile info Misc/Data/community-plugins.json '\n  $info[0] | map(. + ($stats[0][.id] // {}))\n  | map(select(.downloads > 100000))\n  | sort_by(-.downloads)\n  | .[0:100][]\n  | {id: .id, downloads: .downloads}\n' | jq -c\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-dataviewjs",children:'const { Notice } = require(\'obsidian\');\n\n// \u72b6\u6001\u5e38\u91cf\u914d\u7f6e\nconst STATE_CONFIG = {\n  symbols: ["X", "P", "/", "+", "?", "C", "-"],\n  names: ["\u5fc5\u5907", "\u63a8\u8350", "\u53ef\u9009", "\u5907\u7528", "\u5f85\u5b9a", "\u4e0d\u7528", "\u5e9f\u5f03"]\n};\n\n// \u521b\u5efa\u72b6\u6001\u6620\u5c04\nconst createStateMaps = () => {\n  const { symbols, names } = STATE_CONFIG;\n  const stateMap = new Map(symbols.map((key, index) => [key, names[index]]));\n  const reversedStateMap = new Map(names.map((value, index) => [value, symbols[index]]));\n  return { stateMap, reversedStateMap };\n};\n\nconst installedPlugins = app.plugins.manifests;\nconst enabledPlugins = app.plugins.plugins;\n\n// \u52a0\u8f7d\u6570\u636e\nasync function loadData() {\n  const CACHE_AGE = 6048e5; // 7\u5929\n  const DATA_MAP = {\n    plugins: {\n      path: "Misc/community-plugins.json",\n      url: "https://raw.githubusercontent.com/obsidianmd/obsidian-releases/master/community-plugins.json",\n    },\n    stats: {\n      path: "Misc/community-plugin-stats.json",\n      url: "https://raw.githubusercontent.com/obsidianmd/obsidian-releases/master/community-plugin-stats.json",\n    },\n  };\n\n  // \u6b65\u9aa41\uff1a\u5224\u65ad\u4e0b\u8f7d\u9700\u6c42\n  const needsUpdate = await Promise.all(\n    Object.entries(DATA_MAP).map(async ([type, { path }]) =>\n      app.vault.adapter\n        .stat(path)\n        .then((s) => Date.now() - s.mtime > CACHE_AGE)\n        .catch(() => true)\n    )\n  );\n\n  // \u6b65\u9aa42\uff1a\u5e76\u884c\u4e0b\u8f7d\uff08\u5e26\u8d85\u65f6\uff09\n  const fetchWithTimeout = (url) => {\n    const ctrl = new AbortController();\n    const timeout = setTimeout(() => ctrl.abort(), 30000);\n\n    return fetch(url, { signal: ctrl.signal })\n      .then((res) => (res.ok ? res.text() : Promise.reject(res.status)))\n      .finally(() => clearTimeout(timeout));\n  };\n\n  await Promise.allSettled(\n    Object.entries(DATA_MAP).map(async ([type, { path, url }], i) => {\n      if (!needsUpdate[i]) return;\n\n      try {\n        console.debug(`[${type}] \u5f00\u59cb\u66f4\u65b0`);\n        const text = await fetchWithTimeout(url);\n        await app.vault.adapter.write(path, text);\n        console.info(`[${type}] \u66f4\u65b0\u6210\u529f`);\n        new Notice(\'\u2705 \u6570\u636e\u5df2\u66f4\u65b0\', 5000);\n      } catch (e) {\n        console.warn(`[${type}] \u66f4\u65b0\u5931\u8d25\uff1a${e}`);\n      }\n    })\n  );\n\n  // \u6b65\u9aa43\uff1a\u7edf\u4e00\u8bfb\u53d6\u8fd4\u56de\n  return Object.fromEntries(\n    await Promise.all(\n      Object.entries(DATA_MAP).map(async ([type, { path }]) => [\n        `${type}Data`,\n        JSON.parse(await app.vault.adapter.read(path)),\n      ])\n    )\n  );\n}\n\n// \u89e3\u6790\u63d2\u4ef6\u72b6\u6001\u6570\u636e\nfunction parsePluginStates(content) {\n  const { stateMap } = createStateMaps();\n\n  return content.split("\\n").reduce((acc, line) => {\n    // \u4fee\u6b63\u540e\u7684\u5355\u884c\u6b63\u5219\uff08\u65e0\u6362\u884c\u95ee\u9898\uff09\n    const match = line.match(\n      /^-\\s+\\[(.)\\]\\s+\\[([^|\\]]+)(?:\\|([^\\]]*))?\\]\\s*(?:\\(https:\\/\\/github\\.com\\/([\\w-]+\\/[\\w-]+)\\))?(?:\\s*\\|\\s*(.*))?$/\n    );\n    if (!match) return acc;\n\n    const [, state, idPart, namePart, repo, attrsStr] = match.map((s) =>\n      (s || "").trim()\n    );\n\n    // \u57fa\u7840\u4fe1\u606f\u5904\u7406\n    const entry = {\n      state: stateMap.get(state),\n      id: idPart.replace(/\\\\([\\\\|])/g, "$1"),\n      ...(namePart && { name: namePart.replace(/\\\\([\\\\|])/g, "$1") }),\n      ...(repo && { repo }),\n    };\n\n    // \u5f3a\u5236\u952e\u503c\u5bf9\u5c5e\u6027\u89e3\u6790\n    if (attrsStr) {\n      attrsStr.split("|").forEach((segment) => {\n        const [key, ...vals] = segment.split(":").map((s) => s.trim());\n        if (vals.length) entry[key] = vals.join(":");\n      });\n    }\n\n    acc[entry.id] = entry;\n    return acc;\n  }, {});\n}\n\n// \u5408\u5e76\u6570\u636e\nfunction mergeData(plugins, stats, stateContent) {\n  const pluginStates = parsePluginStates(stateContent);\n  \n  return plugins.map((plugin, index) => ({\n    state: Object.keys(enabledPlugins).includes(plugin.id) ? "**\u5df2\u542f\u7528**" : Object.keys(installedPlugins).includes(plugin.id) ? "\u672a\u542f\u7528" : "\u672a\u5b89\u88c5",\n    ...(pluginStates[plugin.id] || {}),\n    ...plugin,\n    index,\n    downloads: stats[plugin.id]?.downloads || 0,\n    updated: stats[plugin.id]?.updated || \'\',\n  }));\n}\n\n// \u6e32\u67d3\u8f93\u51fa\nfunction renderList(filteredData) {\n  const { reversedStateMap } = createStateMaps();\n  const content = filteredData.map((p) => `[${reversedStateMap.get(p.state) || " "}] [${p.id}|${p.name}](https://github.com/${p.repo})`);\n  dv.paragraph("```ad-info\\n" + dv.markdownList(content) + "\\n```");\n}\n\nfunction renderTable(data, fields=[\'name\', \'updated\', \'downloads\', \'state\']) {\n  // \u9ed8\u8ba4\u683c\u5f0f\u5316\u51fd\u6570\u6620\u5c04\uff08\u7cbe\u7b80\u7248\uff09\n  const defaultFormatter = {\n    name: (p) => `[${p.name}](https://github.com/${p.repo})`,\n    updated: (p) => moment(p.updated).fromNow(),\n    downloads: (p) => p.downloads.toLocaleString(),\n    state: (p) => p.state,\n  };\n  // \u6807\u51c6\u5316\u5b57\u6bb5\u914d\u7f6e\n  const normalizedFields = fields.map((f) => {\n    const field = typeof f === "string" ? { name: f } : f;\n    // \u786e\u5b9a\u683c\u5f0f\u5316\u51fd\u6570\n    field.format =\n      field.format ||\n      defaultFormatter[field.name] ||\n      ((p) => p[field.name] || "");\n\n    return field;\n  });\n  // \u751f\u6210\u5e76\u6e32\u67d3\u8868\u683c\n  dv.table(\n    normalizedFields.map((f) => f.name),\n    data.map((obj) => normalizedFields.map((f) => f.format(obj)))\n  );\n}\n\n// \u4e3b\u6267\u884c\u6d41\u7a0b\nasync function main() {\n  const { pluginsData, statsData } = await loadData();\n  const stateContent = await dv.io.load(dv.current().file.path);\n  \n  const mergedData = mergeData(pluginsData, statsData, stateContent);\n  const filteredData = mergedData\n    .filter(p => \n        // \u786e\u4fdd\u5df2\u5b89\u88c5\u7684\u63d2\u4ef6\u65e0\u6761\u4ef6\u4fdd\u7559\uff0c\u672a\u5b89\u88c5\u7684\u63d2\u4ef6\u9700\u6ee1\u8db3\u6761\u4ef6\n        (p.id in installedPlugins) || \n        (moment(p.updated).isAfter(moment().subtract(1, "years")) && \n        p.downloads > 10000\n    ))\n    .sort((a, b) => b.downloads - a.downloads || a.id.localeCompare(b.id));\n\n  dv.header(2, "Popular");\n  renderTable(filteredData);\n  dv.list(Object.keys(installedPlugins).filter(id => !mergedData.some(p => p.id === id)).sort((a, b) => a.localeCompare(b)));\n  \n  dv.header(2, "New");\n  renderTable(mergedData.filter(p => p.downloads > 1000).slice(-100).toReversed());\n  \n  dv.header(2, "Canvas");\n  renderTable(mergedData.filter(p=>["id", "name", "description"].some(attr => String(p[attr]).toLowerCase().includes("canvas"))), [\'name\', \'description\', \'downloads\']);\n}\n\nawait main();\n'})})]})}function c(n={}){const{wrapper:t}={...(0,i.R)(),...n.components};return t?(0,s.jsx)(t,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}}}]);